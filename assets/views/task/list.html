<div page-header>
    <h4 ng-hide="taskParams.iterationCount">List of tasks</h4>
    <h4 ng-show="taskParams.iterationCount">Tasks repeated {{ taskParams.iterationCount }} and more times</h4>
</div>

<div class="well">
    <form class="form-search">
        <table class="well">
            <tr>
                <td style="padding: 5px;" class="muted">TaskId:</td>
                <td style="padding: 5px;">
                    <input type="text" ng-model="taskParams.taskId" ng-disabled="taskParams.iterationCount" class="input-medium search-query" style="width: 300px"/>
                </td>
            </tr>
            <tr>
                <td style="padding: 5px;" class="muted">ProcessId:</td>
                <td style="padding: 5px;">
                    <input type="text" ng-model="taskParams.processId" ng-disabled="taskParams.iterationCount" class="input-medium search-query" style="width: 300px"/>
                </td>
            </tr>
            <tr>
                <td style="padding: 5px;" class="muted">Task attempts:</td>
                <td style="padding: 5px;">
                    <input type="number" min="0" ng-model="taskParams.iterationCount" class="input-medium search-query" style="width: 50px"/>
                </td>
            </tr>
            <tr>
                <td></td>
                <td style="padding: 5px;">
                    <button class="btn" ng-click="update()">Search</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<page-message></page-message>

<div class="well">
    <list-reload params="taskParams" model="tasksPage" update="update()">
    </list-reload>

    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th style="width: 50px">â„–</th>
                <th>UUID</th>
                <th>Process UUID</th>
                <th>Type</th>
                <th>ActorId</th>
                <th>Method</th>
                <th>Arguments</th>
            </tr>
        </thead>

        <tbody>
            <tr ng-repeat="task in tasksPageLoadedItems">
                <td>
                    {{ tasksPageLoaded.$startIndex + $index }}
                </td>
                <td>
                    <small><a ui-sref="task({taskId: task.taskId, processId:task.processId})" style="cursor: pointer;" >
                            {{task.taskId}}</a>
                    </small>
                </td>
                <td>
                    <small><a ui-sref="process({processId:task.processId})"  style="cursor: pointer;">
                            {{task.processId}}</a></small>
                </td>
                <td>
                    <small><b>{{task.type}}</b></small>
                </td>
                <td>
                    <small ng-bind-html="task.actorId | lineWrap"></small>
                </td>
                <td>
                    <small><b>{{task.method}}</b></small>
                </td>
                <td>
                    <button ng-show="task.args && task.args.length"
                            ng-click="showArgs(task)" class="btn btn-mini"
                            popover="Show arguments"
                            popover-trigger="mouseenter">
                        <span class="icon-info-sign" />
                    </button>
                </td>
            </tr>
        </tbody>

        <tfoot>
            <tr>
                <td colspan="7">
                    <list-paginator params="taskParams" model="tasksPageLoaded" update="update()">
                    </list-paginator>
                </td>
            </tr>
        </tfoot>

    </table>

    <div>Total: <b>{{tasksPageLoaded.totalCount || tasksPageLoadedItems.length}}</b> tasks</div>
</div>