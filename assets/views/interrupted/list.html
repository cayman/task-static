<div page-header="Interrupted tasks">
    <h6>{{ formParams }}</h6>
    <!--<h6>{{ loadParams }}</h6>-->
</div>

<div class="well">
    <form class="form-horizontal">
        <div class="control-group">
            <label class="control-label">
                <small>
                    <b>Date period <a ng-click="formParams.withTime = !formParams.withTime">(with time)</a>:</b>
                </small>
            </label>
            <table class="controls">
                <tr>
                    <td valign="center">From:<span input-date="formParams.dateFrom"></span></td>
                    <td ng-if="formParams.withTime"><span input-time="formParams.dateFrom"></span></td>
                    <td valign="center">&nbsp;To:<span input-date="formParams.dateTo"></span></td>
                    <td ng-if="formParams.withTime"><span input-time="formParams.dateTo"></span></td>
                </tr>
            </table>
        </div>
        <fieldset class="scheduler-border">
            <!--<legend class="scheduler-border">Filtered by:</legend>-->
            <div class="control-group">
                <label class="control-label" for="starter"><small><b>{{ groups.starter.label }}:</b></small></label>
                <div class="controls">
                    <input class="input search-query" type="text" id="starter" placeholder="ru.taskurotta.Example#1.0"
                           ng-model="formParams.starterId" on-enter="search()"/>
                    <i class="icon-question-sign" popover="{{ groups.starter.desc }}" popover-trigger="mouseenter" popover-placement="right"></i>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="actor"><small><b>{{ groups.actor.label }}:</b></small></label>
                <div class="controls">
                    <input class="input search-query" type="text" id="actor" placeholder="ru.taskurotta.Example#1.0"
                           ng-model="formParams.actorId" on-enter="search()"/>
                    <i class="icon-question-sign" popover="{{ groups.actor.desc }}" popover-trigger="mouseenter" popover-placement="right"></i>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="exception"><small><b>{{ groups.exception.label }}:</b></small></label>
                <div class="controls">
                    <input class="input search-query" type="text" id="exception" placeholder="ru.taskurotta.ExampleException"
                           ng-model="formParams.exception" on-enter="search()"/>
                    <i class="icon-question-sign" popover="{{ groups.exception.desc }}" popover-trigger="mouseenter" popover-placement="right"></i>
                </div>
            </div>
        </fieldset>
        <div class="control-group">
            <label class="control-label" for="group"><small><b>Grouped by:</b></small></label>
            <div class="controls">
                <select class="input search-query" id="group" ng-model="formParams.group" style="width: 150px"
                        ng-options="key as key for (key , group) in (groups | orderBy:'+order')">

                </select>
                <button class="btn" ng-click="search()">Search</button>
            </div>
        </div>
    </form>
</div>

<page-message></page-message>

<div class="well" >
    <list-reload model="tempInterruptedModel">
    </list-reload>

    <table class="table table-striped table-condensed table-bordered">
        <thead>
            <tr>
                <th>
                    <small>Task ID</small>
                </th>
                <th>
                    <small>Starter ActorID</small>
                </th>
                <th>
                    <small>Task ActorID</small>
                </th>
                <th style="width:100px">
                    <small>Fail time</small>
                </th>
                <th>
                    <small>Error description</small>
                </th>
                <th>
                    <small>Actions</small>
                </th>
            </tr>
        </thead>
        <tbody>
        <tr ng-repeat="task in interruptedModel.items">
                <td nowrap>
                    <small>
                        <a class="btn-link" ui-sref="task({processId: task.processId, taskId:task.taskId })">
                            <b>{{ task.taskId }}</b></a>
                    </small>
                </td>
                <td>
                    <small ng-bind-html="task.starterId | lineWrap"></small>
                </td>
                <td>
                    <small ng-bind-html="task.actorId | lineWrap"></small>
                </td>
                <td>
                    <small>{{task.time | date:dateTimeFormat }}</small>
                </td>
                <td>
                    <small>
                        <span class="muted"><b>Class: </b></span><b>{{ task.errorClassName }}</b>
                        <br />
                        <span class="muted"><b>Message: </b></span><b>{{ task.errorMessage}}</b>
                        <br />
                        <a ng-show="task.stackTrace" class="btn-link" ng-click="showStackTrace(task.stackTrace)">
                            <i class="icon-list"></i><b>Stack trace</b></a>
                        <br />
                    </small>
                </td>
                <td>
                    <button ng-click="restart(task)" popover="Try to restart the task" popover-trigger="mouseenter"><i class="icon-retweet"></i></button>
                </td>
            </tr>
        </tbody>

        <tfoot>
            <tr>
                <td colspan="7">
                    <list-paginator model="interruptedModel">
                    </list-paginator>
                </td>
            </tr>
        </tfoot>
    </table>

</div>